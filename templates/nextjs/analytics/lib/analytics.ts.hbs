{{#if isPostHog}}
import posthog from "posthog-js";

let initialized = false;

export function initAnalytics() {
  if (typeof window === "undefined" || initialized) return;

  posthog.init(process.env.NEXT_PUBLIC_POSTHOG_KEY!, {
    api_host: process.env.NEXT_PUBLIC_POSTHOG_HOST || "https://app.posthog.com",
    capture_pageview: true,
    capture_pageleave: true,
{{#if gdpr}}
    opt_out_capturing_by_default: true,
{{/if}}
  });

  initialized = true;
}

export function trackEvent(event: string, properties?: Record<string, any>) {
  posthog.capture(event, properties);
}

export function identifyUser(userId: string, traits?: Record<string, any>) {
  posthog.identify(userId, traits);
}

export function resetUser() {
  posthog.reset();
}

{{#if gdpr}}
export function optIn() {
  posthog.opt_in_capturing();
}

export function optOut() {
  posthog.opt_out_capturing();
}

export function hasOptedIn(): boolean {
  return posthog.has_opted_in_capturing();
}
{{/if}}
{{else if isMixpanel}}
import mixpanel from "mixpanel-browser";

export function initAnalytics() {
  if (typeof window === "undefined") return;
  mixpanel.init(process.env.NEXT_PUBLIC_MIXPANEL_TOKEN!, {
    track_pageview: true,
{{#if gdpr}}
    opt_out_tracking_by_default: true,
{{/if}}
  });
}

export function trackEvent(event: string, properties?: Record<string, any>) {
  mixpanel.track(event, properties);
}

export function identifyUser(userId: string, traits?: Record<string, any>) {
  mixpanel.identify(userId);
  if (traits) mixpanel.people.set(traits);
}

export function resetUser() {
  mixpanel.reset();
}
{{else if isPlausible}}
export function initAnalytics() {
  // Plausible loads via script tag — no JS init needed
}

export function trackEvent(event: string, properties?: Record<string, any>) {
  if (typeof window !== "undefined" && (window as any).plausible) {
    (window as any).plausible(event, { props: properties });
  }
}

export function identifyUser(_userId: string, _traits?: Record<string, any>) {
  // Plausible is privacy-first — no user identification
}

export function resetUser() {}
{{else}}
export function initAnalytics() {
  // TODO: Initialize your analytics provider
}

export function trackEvent(event: string, properties?: Record<string, any>) {
  if (process.env.NODE_ENV === "development") {
    console.log("[Analytics]", event, properties);
  }
  // TODO: Send to your analytics provider
}

export function identifyUser(userId: string, traits?: Record<string, any>) {
  // TODO: Identify user in your analytics provider
}

export function resetUser() {
  // TODO: Reset user identity
}
{{/if}}
